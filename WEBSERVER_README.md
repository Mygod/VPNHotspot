# WebServer 功能使用说明

## 概述

VPNHotspot 应用现在集成了一个内置的 WebServer，允许通过网页界面控制热点功能和查看系统状态。

## 功能特性

### 1. 系统状态监控
- **电量显示**: 实时显示设备电池电量百分比
- **温度监控**: 显示电池温度
- **CPU占用**: 显示当前CPU使用率
- **WiFi热点状态**: 显示WiFi热点是否运行中

### 2. 热点控制
- **启动WiFi热点**: 通过网页按钮启动WiFi热点分享
- **停止WiFi热点**: 通过网页按钮停止WiFi热点分享

## 使用方法

### 1. 启动WebServer
应用启动时会自动启动WebServer，监听9999端口。

### 2. 访问方式

#### 方式一：蓝牙网络共享
1. 在手机上启用蓝牙网络共享（蓝牙PAN）
2. 其他设备通过蓝牙连接到手机
3. 在浏览器中访问：`http://手机蓝牙IP:9999`

#### 方式二：WiFi热点
1. 手机开启WiFi热点
2. 其他设备连接到该WiFi热点
3. 在浏览器中访问：`http://手机WiFi热点IP:9999`

#### 方式三：USB网络共享
1. 手机通过USB连接电脑，启用USB网络共享
2. 在电脑浏览器中访问：`http://手机USB网络IP:9999`

### 3. 网页界面

访问网页后，你将看到：

```
VPN热点控制面板
├── 系统状态
│   ├── 电量: XX%
│   ├── 温度: XX°C
│   ├── CPU占用: XX%
│   └── WiFi热点: 运行中/已停止
└── 热点控制
    ├── [启动WiFi热点] 按钮
    └── [停止WiFi热点] 按钮
```

### 4. API接口

除了网页界面，还提供以下API接口：

- `GET /status` - 获取系统状态（JSON格式）
- `POST /wifi/start` - 启动WiFi热点
- `POST /wifi/stop` - 停止WiFi热点

## 技术实现

- **HTTP Server**: 使用 NanoHTTPD 库
- **监听端口**: 9999
- **访问范围**: 局域网内所有设备
- **自动刷新**: 状态每30秒自动刷新一次

## 注意事项

1. **权限要求**: 需要网络权限和热点控制权限
2. **Android版本**: WiFi热点控制支持Android 7.0 (API 24) 及以上版本，通过 TetheringManagerCompat 自动处理版本兼容性
3. **网络安全**: WebServer仅在局域网内可访问，不对外网开放
4. **电池优化**: 建议将应用加入电池优化白名单，确保WebServer持续运行

## 故障排除

### WebServer无法启动
- 检查9999端口是否被占用
- 确认应用有网络权限
- 查看应用日志中的错误信息

### 无法访问网页
- 确认设备在同一网络下
- 检查防火墙设置
- 尝试使用不同的网络连接方式

### 热点控制失败
- 确认Android版本支持（需要API 30+）
- 检查热点相关权限
- 确认没有其他应用占用热点功能

## 开发信息

- **文件位置**: `mobile/src/main/java/be/mygod/vpnhotspot/WebServer.kt`
- **启动位置**: `MainActivity.onCreate()`
- **依赖库**: `org.nanohttpd:nanohttpd:2.3.1` 